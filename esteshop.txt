===Клиент часть===

\catalog\view\theme\prostore\template\mail\voucher.twig - HTML-структура для электронного письма получателю сертификата
\catalog\view\theme\prostore\template\extension\total\voucher.twig - внешний вид блока в корзине, который позволяет применить (вписать) код сертификата (в том же табе меняется с купоном)
\catalog\view\theme\prostore\template\account\voucher.twig - внешний вид формы заполнения сертификата. Имя, сообщение и т д  https://esteshop.ru/vouchers/

\catalog\controller\account\voucher.php - управляет созданием и обработкой подарочных ваучеров
        Подробнее:
        index(): Загружает языковые файлы и устанавливает заголовок документа. Проверяет наличие сессионной переменной vouchers и инициализирует её, если необходимо. Обрабатывает данные формы (POST запрос), валидирует их и добавляет информацию о ваучере в сессию, если данные прошли валидацию. Перенаправляет пользователя на страницу успеха при успешной обработке данных. Устанавливает необходимые переменные для отображения в шаблоне, включая ошибки, данные формы и темы ваучеров. Ваучеры хранятся в сессии пользователя, что позволяет временно сохранять данные на протяжении активной сессии без необходимости немедленного сохранения в базу данных. Используются перенаправления для управления потоком пользователя после выполнения определённых действий, а также формируются ссылки для навигации по сайту.
        success(): Отображает страницу успеха после успешного добавления ваучера. Устанавливает необходимые хлебные крошки и ссылки для навигации.
        validate(): Проводит валидацию введённых данных, проверяя соответствие длины строк, корректность email и допустимость значений суммы ваучера. В случае ошибок формирует сообщения об этих ошибках. 
\catalog\controller\extension\total\voucher.php - управляет логикой подарочных ваучеров в контексте расчета итоговой суммы заказа (total)
\catalog\controller\api\voucher.php - позволяет программно добалять сертификаты
        Подробнее:
        index(): Проверяет, есть ли доступ к API (проверка api_id в сессии). Позволяет запросить информацию о ваучере по его коду. Если ваучер найден, информация о нем сохраняется в сессии, и возвращается сообщение об успехе. Если ваучер не найден, возвращается ошибка.
        add(): Также проверяет доступ к API. Принимает данные из POST-запроса для создания нового ваучера. Данные включают информацию об отправителе и получателе ваучера, тему ваучера, сообщение, сумму и другие. Проверяет данные на корректность, включая валидацию электронных адресов и проверку диапазона суммы ваучера. Если все данные корректны, ваучер добавляется в сессию, что позволяет его дальнейшее использование при оформлении заказа. При успешном добавлении ваучера удаляются данные о выбранных методах доставки и оплаты из сессии, чтобы они могли быть пересчитаны при переходе к оформлению заказа.

\catalog\model\extension\total\voucher.php - управление сертификатами, во время применения их к заказам.
        Подробнее:
        addVoucher($order_id, $data): Добавляет новый ваучер в базу данных. Это включает информацию о том, кто отправил и кому предназначен ваучер, сумму, сообщение, идентификатор темы ваучера и другие параметры. Эта функция также возвращает последний ID, добавленный в базу данных.
        disableVoucher($order_id): Отключает ваучер, связанный с определенным заказом, устанавливая его статус как "неактивный".
        getVoucher($code): Получает информацию о ваучере по его коду. Проверяет, был ли ваучер использован в завершенном заказе, и определяет, был ли он уже использован полностью или нет. Возвращает массив с деталями ваучера, если он активен и имеет остаточную сумму.
        getTotal($total): Вычисляет и применяет скидку от ваучера к общей сумме заказа. Удаляет ваучер из сессии, если он не действителен или если сумма скидки равна нулю.
        confirm($order_info, $order_total): Подтверждает использование ваучера при создании заказа. Регистрирует использование ваучера, добавляя запись в историю ваучеров. В случае ошибки может возвращать статус, указывающий на мошенничество.
        unconfirm($order_id): Удаляет записи о ваучере из истории при отмене заказа.
\catalog\model\extension\total\voucher_theme.php - позволяет извлекать информацию о конкретной теме ваучера или список всех тем
Подробнее:
        getVoucherTheme($voucher_theme_id): Этот метод возвращает данные определённой темы ваучера, включая её описание, основываясь на идентификаторе темы ваучера (voucher_theme_id) и языке (language_id). Он выполняет SQL-запрос, который объединяет таблицы voucher_theme и voucher_theme_description для извлечения всех данных о теме.
        getVoucherThemes($data = array()): Этот метод извлекает список всех тем ваучеров, с возможностью настройки порядка и количества результатов через массив $data. Он также поддерживает пагинацию, что позволяет ограничивать количество возвращаемых тем. Если параметры не предоставлены, метод проверяет наличие данных в кэше и, если они отсутствуют, выполняет запрос к базе данных для извлечения всех доступных тем, сохраняя результаты в кэше для ускорения будущих запросов.
        
\catalog\language\ru-ru\mail\voucher.php
\catalog\language\ru-ru\extension\total\voucher.php
\catalog\language\ru-ru\api\voucher.php
\catalog\language\ru-ru\account\voucher.php
\catalog\language\en-gb\mail\voucher.php
\catalog\language\en-gb\extension\total\voucher.php
\catalog\language\en-gb\api\voucher.php
\catalog\language\en-gb\account\voucher.php

===Админка===

\admin\view\template\sale\voucher_history.twig - внешний вид админки конкретного сертификата, история https://esteshop.ru/admin/index.php?route=sale/voucher/edit&user_token=0qde9r2dV2mecor1DNBZBuHLflv7zMuw&voucher_id=9
\admin\view\template\mail\voucher.twig - вывод (внешний вид/поля) сообщения, которое отправляется получателю сертификата 
\admin\view\template\extension\total\voucher.twig - внешний вид админки конкретного сертификата, общее https://esteshop.ru/admin/index.php?route=sale/voucher/edit&user_token=0qde9r2dV2mecor1DNBZBuHLflv7zMuw&voucher_id=9
\admin\view\template\sale\voucher_list.twig - внешний вид админки списка сертификатов, таблица сертификатов https://esteshop.ru/admin/index.php?route=sale/voucher&user_token=0qde9r2dV2mecor1DNBZBuHLflv7zMuw
\admin\view\template\sale\voucher_theme_form.twig - внешний вид админки конкретной темы сертификата https://esteshop.ru/admin/index.php?route=sale/voucher_theme/edit&user_token=0qde9r2dV2mecor1DNBZBuHLflv7zMuw&voucher_theme_id=7
\admin\view\template\sale\voucher_theme_list.twig - внешний вид админки списка тем сертификатов https://esteshop.ru/admin/index.php?route=sale/voucher_theme&user_token=0qde9r2dV2mecor1DNBZBuHLflv7zMuw
\admin\view\template\sale\voucher_form.twig -внешний вид админки списка сертификатов, верхние кнопки (отправить/удалить и т д) https://esteshop.ru/admin/index.php?route=sale/voucher&user_token=0qde9r2dV2mecor1DNBZBuHLflv7zMuw

\admin\controller\sale\voucher.php - логика при работе здесь \admin\view\template\sale\voucher_list.twig, т е функции для просмотра списка сертификатов, добавления новых, редактирования существующих, удаления, а также отправки подарочных сертификатов клиентам
        Подробнее:
        index(): Загружает список всех подарочных сертификатов. Этот метод устанавливает заголовок страницы, загружает языковые файлы и модель, а затем вызывает метод getList(), который выводит список всех сертификатов.
        add() и edit(): Оба метода используются для добавления нового сертификата или редактирования существующего. Они загружают необходимые языковые файлы, устанавливают заголовок страницы, загружают модель и проверяют данные формы на валидность. Если данные проходят проверку, выполняют добавление или обновление данных сертификата в базе данных и перенаправляют пользователя обратно к списку сертификатов.
        delete(): Удаляет один или несколько выбранных подарочных сертификатов. Этот метод также проверяет права пользователя на удаление и возвращает обратно к списку сертификатов после выполнения операции.
        getList(): Подготавливает данные для отображения страницы списка всех подарочных сертификатов, включая создание пагинации, сортировки и формирование каждой строки сертификата для отображения в таблице.
        getForm(): Отображает форму для добавления или редактирования подарочного сертификата. Этот метод подготавливает все необходимые данные для формы, включая информацию о выбранном сертификате (если это редактирование), и выводит соответствующий шаблон.
        validateForm() и validateDelete(): Эти методы проверяют, имеет ли пользователь права на выполнение действий и корректность введенных данных. Они возвращают true или false в зависимости от результатов проверки.
        send(): Отправляет подарочные сертификаты на электронные адреса получателей. Метод загружает информацию о сертификате, формирует текст письма и использует объект Mail для отправки.
\admin\controller\sale\voucher_theme.php - логика управления темами подарочных сертификатов в админки
        Подробнее:
        index(): Загружает языковые файлы и модель тем подарочных сертификатов. Устанавливает заголовок документа. Вызывает метод getList() для отображения списка всех тем подарочных сертификатов.
        add() и edit(): Эти методы загружают необходимые языковые файлы и модель, устанавливают заголовок документа. Проверяют, был ли запрос отправлен методом POST и валидны ли данные формы. Если да, то происходит добавление новой темы или редактирование существующей. После добавления или редактирования осуществляется перенаправление на список тем с сообщением об успехе.
        delete(): Загружает языковые файлы и модель. Удаляет выбранные темы подарочных сертификатов после проверки прав пользователя на удаление. Перенаправляет на страницу списка тем с сообщением об успехе.
        getList(): Подготавливает данные для отображения списка тем подарочных сертификатов, включая пагинацию и сортировку. Загружает список тем из модели и передает его в шаблон для отображения.
        getForm(): Загружает данные для формы добавления или редактирования темы. Подготавливает данные для всех языков, доступных в системе. Загружает изображение темы, если оно доступно, и передает данные в шаблон.
        validateForm(): Проверяет права пользователя на изменение тем и валидность введенных данных. Возвращает true, если форма валидна, и false в противном случае.
        validateDelete(): Проверяет права пользователя на удаление. Проверяет, не связаны ли удаляемые темы с существующими подарочными сертификатами. Возвращает true, если удаление возможно, и false, если нет.
\admin\controller\extension\total\voucher.php - логика работы с самим модулем в opencart, n t удалить, установить, модифицировать
        Подробнее:
        index(): Загружает языковые файлы и настройки модуля. Устанавливает заголовок страницы. Обрабатывает сохранение изменений в настройках модуля после отправки формы. При успешном сохранении настроек пользователь перенаправляется обратно в список расширений. Подготавливает данные для вывода на странице настроек модуля, включая хлебные крошки и значения конфигураций.
        validate(): Проверяет, имеет ли пользователь необходимые права для модификации настроек модуля. Если нет, добавляет ошибку в массив ошибок.
        install(): Вызывается при установке модуля. Регистрирует события, которые должны быть вызваны при определенных действиях в системе. Например, при добавлении истории заказа может вызываться событие для отправки ваучера.
        uninstall(): Вызывается при удалении модуля. Удаляет регистрации событий, связанных с модулем, чтобы избежать нежелательного выполнения кода после удаления модуля.

\admin\model\sale\voucher.php - модель для работы с сертификатами. Удаление, измененние, добавление и т. д.
        Подробнее:
        addVoucher($data) Добавляет новый ваучер в базу данных. Принимает массив с данными о ваучере, такими как код, имена и адреса отправителя и получателя, ID темы ваучера, сообщение, сумму, статус и дату добавления. Возвращает ID добавленного ваучера.
        editVoucher($voucher_id, $data) Обновляет существующий ваучер в базе данных. Принимает ID ваучера и массив данных для обновления.
        deleteVoucher($voucher_id) Удаляет ваучер и связанную с ним историю из базы данных по заданному ID ваучера.
        getVoucher($voucher_id) Возвращает данные одного ваучера по его ID.
        getVoucherByCode($code) Ищет ваучер по его уникальному коду и возвращает его данные.
        getVouchers($data = array()) Возвращает список ваучеров с возможностью сортировки и пагинации. Поддерживает фильтрацию по различным параметрам через массив $data.
        getTotalVouchers() Возвращает общее количество ваучеров в базе данных.
        getTotalVouchersByVoucherThemeId($voucher_theme_id) Возвращает количество ваучеров, использующих определенную тему ваучера.
        getVoucherHistories($voucher_id, $start = 0, $limit = 10) Возвращает историю операций по ваучеру, такие как использование ваучера в заказах, с информацией о заказе и клиенте.
    getTotalVoucherHistories($voucher_id) Возвращает общее количество записей в истории операций по заданному ваучеру.
\admin\model\sale\voucher_theme.php - модель для работы с тема сертификатов. Удаление, измененние, добавление и т. д.

\admin\language\en-gb\mail\voucher.php
\admin\language\en-gb\extension\total\voucher.php
\admin\language\ru-ru\sale\voucher.php
\admin\language\ru-ru\sale\voucher_theme.php
\admin\language\ru-ru\mail\voucher.php
\admin\language\ru-ru\extension\total\voucher.php
\admin\language\en-gb\sale\voucher.php
\admin\language\en-gb\sale\voucher_theme.php




1. Добавить в клиентскую часть возможность указывать дату и время отправки
2. Ввести обработку этих данных и запись в базу
3. Добавить возможность вывода столбца с датой и временем в админку


Что будет делать запускаемый код?
1. Найти в базе дату и время отправления подарочных сертификатов
2. Если дата и время уже наступили, взять все остальные данные об этом сертификате (код, фио отправителя и получения, сообщение, картинка, сумма)
3. Прокинуть эти данные в шаблон, который будет отправляться на mail
4. Отправить сообщение получателю
5. Отправить стандартное сообщение покупателю (по типу, заказанный вами сертификат такого-то числа на такую-то сумму был отправлен на такой-то email)
6. отправить стандартное сообщение админу (сертификат на такую-то сумму был отправлен тому-то)




Сделано:
1. Создали элемент формы с возможностью выбора даты отправления ваучера

\catalog\view\theme\prostore\template\account\voucher.twig
<div class="form-group">
<label class="ui-label" for="send_time">{{ entry_send_time }}</label>
<div class="ui-field">
<input type="date" id="send_time" name="send_time" value="{{ 'now'|date('Y-m-d') }}" min="{{ 'now'|date('Y-m-d') }}" />
</div>
</div>

2. Добавила переменную в словарь
C:\Users\kristina\OpenServer\domains\esteshop.ru\web\catalog\language\ru-ru\account\voucher.php
$_['entry_send_time']  = 'Выберете время и дату отправления сертификата';


3.







